<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skills Evaluation Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --skilled: #58a6ff;
      --vanilla: #8b949e;
      --green: #3fb950;
      --red: #f85149;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 { font-size: 24px; margin-bottom: 4px; }
    .subtitle { color: var(--text-muted); margin-bottom: 24px; font-size: 14px; }
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }
    .card-label { color: var(--text-muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .card-value { font-size: 32px; font-weight: 600; margin-top: 4px; }
    .card-delta { font-size: 14px; margin-top: 4px; }
    .positive { color: var(--green); }
    .negative { color: var(--red); }
    .neutral { color: var(--text-muted); }
    .section-title { font-size: 18px; margin: 32px 0 16px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 24px;
    }
    .chart-container {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
    }
    .chart-container h3 { font-size: 14px; margin-bottom: 12px; color: var(--text-muted); }
    .chart-container canvas { width: 100% !important; }
    .footer {
      margin-top: 48px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 12px;
      text-align: center;
    }
    .footer a { color: var(--skilled); text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
    @media (max-width: 600px) {
      .charts-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>ðŸ“Š Skills Evaluation Dashboard</h1>
  <p class="subtitle">Tracking Copilot quality with and without MSBuild skills plugin</p>

  <div id="summary-cards" class="summary-cards"></div>

  <h2 class="section-title">Quality Over Time (per scenario)</h2>
  <div id="quality-charts" class="charts-grid"></div>

  <h2 class="section-title">Efficiency Over Time (per scenario)</h2>
  <div id="efficiency-charts" class="charts-grid"></div>

  <div class="footer">
    Generated by <a href="https://github.com/ViktorHofer/dotnet-skills">dotnet-skills</a> evaluation pipeline
  </div>

  <script src="data.js"></script>
  <script>
    const data = window.BENCHMARK_DATA;
    if (!data || !data.entries) {
      document.body.innerHTML = '<h1>No benchmark data available yet.</h1>';
    } else {
      const qualityEntries = data.entries['Skills Evaluation - Quality'] || [];
      const efficiencyEntries = data.entries['Skills Evaluation - Efficiency'] || [];

      // Extract scenario names from the latest quality entry
      const latestQuality = qualityEntries[qualityEntries.length - 1];
      const scenarios = new Set();
      if (latestQuality) {
        latestQuality.benches.forEach(b => {
          const match = b.name.match(/^(.+) - (Skilled|Vanilla) Quality$/);
          if (match) scenarios.add(match[1]);
        });
      }

      // Build summary cards from latest data
      const summaryDiv = document.getElementById('summary-cards');
      if (latestQuality) {
        const skilledAvg = latestQuality.benches.find(b => b.name === 'Overall - Skilled Avg Quality');
        const vanillaAvg = latestQuality.benches.find(b => b.name === 'Overall - Vanilla Avg Quality');
        if (skilledAvg && vanillaAvg) {
          const delta = (skilledAvg.value - vanillaAvg.value).toFixed(2);
          const deltaClass = delta > 0 ? 'positive' : delta < 0 ? 'negative' : 'neutral';
          const deltaSign = delta > 0 ? '+' : '';
          summaryDiv.innerHTML = `
            <div class="card">
              <div class="card-label">Skilled Avg</div>
              <div class="card-value" style="color: var(--skilled)">${skilledAvg.value.toFixed(2)}</div>
              <div class="card-delta">out of 5.0</div>
            </div>
            <div class="card">
              <div class="card-label">Vanilla Avg</div>
              <div class="card-value" style="color: var(--vanilla)">${vanillaAvg.value.toFixed(2)}</div>
              <div class="card-delta">out of 5.0</div>
            </div>
            <div class="card">
              <div class="card-label">Delta</div>
              <div class="card-value ${deltaClass}">${deltaSign}${delta}</div>
              <div class="card-delta ${deltaClass}">${delta > 0 ? 'Skills improve quality' : delta < 0 ? 'Skills degrade quality' : 'No difference'}</div>
            </div>
            <div class="card">
              <div class="card-label">Data Points</div>
              <div class="card-value">${qualityEntries.length}</div>
              <div class="card-delta">evaluation runs</div>
            </div>
            <div class="card">
              <div class="card-label">Model</div>
              <div class="card-value" style="font-size: 18px">${latestQuality.model || 'N/A'}</div>
              <div class="card-delta">latest run</div>
            </div>
          `;
        }
      }

      // Helper: create a paired line chart
      function createPairedChart(container, title, entries, nameA, nameB, labelA, labelB, colorA, colorB) {
        const div = document.createElement('div');
        div.className = 'chart-container';
        div.innerHTML = `<h3>${title}</h3><canvas></canvas>`;
        container.appendChild(div);
        const canvas = div.querySelector('canvas');

        const labels = entries.map((e, i) => {
          const d = new Date(e.date);
          return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        });

        const dataA = entries.map(e => {
          const b = e.benches.find(b => b.name === nameA);
          return b ? b.value : null;
        });

        const dataB = entries.map(e => {
          const b = e.benches.find(b => b.name === nameB);
          return b ? b.value : null;
        });

        new Chart(canvas, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label: labelA,
                data: dataA,
                borderColor: colorA,
                backgroundColor: colorA + '20',
                borderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.3,
                fill: false
              },
              {
                label: labelB,
                data: dataB,
                borderColor: colorB,
                backgroundColor: colorB + '20',
                borderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.3,
                borderDash: [5, 5],
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
              legend: { labels: { color: '#8b949e', font: { size: 11 } } },
              tooltip: {
                callbacks: {
                  afterTitle: (items) => {
                    const idx = items[0].dataIndex;
                    const entry = entries[idx];
                    const parts = [];
                    if (entry && entry.model) parts.push(`Model: ${entry.model}`);
                    if (entry && entry.commit) {
                      const msg = entry.commit.message.split('\n')[0];
                      parts.push(msg.length > 60 ? msg.substring(0, 60) + '...' : msg);
                    }
                    return parts.join('\n');
                  }
                }
              }
            },
            scales: {
              x: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } },
              y: {
                ticks: { color: '#8b949e' },
                grid: { color: '#30363d' },
                suggestedMin: title.includes('Quality') ? 1 : undefined,
                suggestedMax: title.includes('Quality') ? 5 : undefined
              }
            }
          }
        });
      }

      // Render quality charts (paired: Skilled vs Vanilla)
      const qualityChartsDiv = document.getElementById('quality-charts');

      // Overall chart first
      createPairedChart(
        qualityChartsDiv, 'Overall Average Quality', qualityEntries,
        'Overall - Skilled Avg Quality', 'Overall - Vanilla Avg Quality',
        'Skilled', 'Vanilla', '#58a6ff', '#8b949e'
      );

      // Per-scenario quality charts
      scenarios.forEach(scenario => {
        createPairedChart(
          qualityChartsDiv, scenario, qualityEntries,
          `${scenario} - Skilled Quality`, `${scenario} - Vanilla Quality`,
          'Skilled', 'Vanilla', '#58a6ff', '#8b949e'
        );
      });

      // Render efficiency charts (single series per scenario)
      const efficiencyChartsDiv = document.getElementById('efficiency-charts');
      if (efficiencyEntries.length > 0) {
        const latestEff = efficiencyEntries[efficiencyEntries.length - 1];
        const effScenarios = new Set();
        latestEff.benches.forEach(b => {
          const match = b.name.match(/^(.+) - Skilled Time$/);
          if (match) effScenarios.add(match[1]);
        });

        effScenarios.forEach(scenario => {
          const div = document.createElement('div');
          div.className = 'chart-container';
          div.innerHTML = `<h3>${scenario}</h3><canvas></canvas>`;
          efficiencyChartsDiv.appendChild(div);
          const canvas = div.querySelector('canvas');

          const labels = efficiencyEntries.map(e => {
            const d = new Date(e.date);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
          });

          const timeData = efficiencyEntries.map(e => {
            const b = e.benches.find(b => b.name === `${scenario} - Skilled Time`);
            return b ? b.value : null;
          });

          const tokenData = efficiencyEntries.map(e => {
            const b = e.benches.find(b => b.name === `${scenario} - Skilled Tokens In`);
            return b ? b.value / 1000 : null;
          });

          new Chart(canvas, {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Time (s)',
                  data: timeData,
                  borderColor: '#f0883e',
                  borderWidth: 2,
                  pointRadius: 4,
                  tension: 0.3,
                  fill: false,
                  yAxisID: 'y'
                },
                {
                  label: 'Tokens In (k)',
                  data: tokenData,
                  borderColor: '#a371f7',
                  borderWidth: 2,
                  pointRadius: 4,
                  tension: 0.3,
                  borderDash: [5, 5],
                  fill: false,
                  yAxisID: 'y1'
                }
              ]
            },
            options: {
              responsive: true,
              interaction: { mode: 'index', intersect: false },
              plugins: { legend: { labels: { color: '#8b949e', font: { size: 11 } } } },
              scales: {
                x: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } },
                y: {
                  type: 'linear',
                  position: 'left',
                  ticks: { color: '#f0883e' },
                  grid: { color: '#30363d' },
                  title: { display: true, text: 'seconds', color: '#f0883e' }
                },
                y1: {
                  type: 'linear',
                  position: 'right',
                  ticks: { color: '#a371f7' },
                  grid: { drawOnChartArea: false },
                  title: { display: true, text: 'tokens (k)', color: '#a371f7' }
                }
              }
            }
          });
        });
      }
    }
  </script>
</body>
</html>
